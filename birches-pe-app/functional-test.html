<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Functional Test - Birches PE App</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        iframe { width: 100%; height: 600px; border: 2px solid #333; }
    </style>
</head>
<body>
    <h1>Functional Test Suite</h1>
    
    <div id="test-results"></div>
    
    <h2>App Preview:</h2>
    <iframe src="http://localhost:5173" id="app-frame"></iframe>
    
    <script>
        const results = document.getElementById('test-results');
        let testsPassed = 0;
        let testsFailed = 0;
        
        function addResult(name, passed, message = '') {
            const div = document.createElement('div');
            div.className = `test ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `<strong>${passed ? '✓' : '✗'} ${name}</strong>${message ? ': ' + message : ''}`;
            results.appendChild(div);
            
            if (passed) testsPassed++;
            else testsFailed++;
        }
        
        async function runTests() {
            // Test 1: Check if app loads
            try {
                const response = await fetch('http://localhost:5173');
                const html = await response.text();
                addResult('App loads', response.ok, `Status: ${response.status}`);
            } catch (e) {
                addResult('App loads', false, e.message);
            }
            
            // Test 2: Check if data files are accessible
            try {
                const standardsRes = await fetch('http://localhost:5173/data/standards.json');
                const standards = await standardsRes.json();
                addResult('Standards data loads', Array.isArray(standards), `Found ${standards.length} standards`);
            } catch (e) {
                addResult('Standards data loads', false, e.message);
            }
            
            try {
                const activitiesRes = await fetch('http://localhost:5173/data/activities.json');
                const activities = await activitiesRes.json();
                addResult('Activities data loads', activities.activities !== undefined, `Found activities object`);
            } catch (e) {
                addResult('Activities data loads', false, e.message);
            }
            
            // Test 3: Check if Service Worker is available
            if ('serviceWorker' in navigator) {
                addResult('Service Worker API available', true);
            } else {
                addResult('Service Worker API available', false);
            }
            
            // Test 4: Check localStorage
            try {
                localStorage.setItem('test-key', 'test-value');
                const value = localStorage.getItem('test-key');
                localStorage.removeItem('test-key');
                addResult('localStorage works', value === 'test-value');
            } catch (e) {
                addResult('localStorage works', false, e.message);
            }
            
            // Summary
            const summary = document.createElement('div');
            summary.className = 'test';
            summary.style.marginTop = '20px';
            summary.style.fontWeight = 'bold';
            summary.innerHTML = `
                <h3>Test Summary</h3>
                <p>Passed: ${testsPassed}</p>
                <p>Failed: ${testsFailed}</p>
                <p>Total: ${testsPassed + testsFailed}</p>
            `;
            results.appendChild(summary);
            
            // Instructions for manual testing
            const instructions = document.createElement('div');
            instructions.style.marginTop = '20px';
            instructions.innerHTML = `
                <h3>Manual Testing Instructions:</h3>
                <ol>
                    <li>In the iframe below, select grade level "K-2"</li>
                    <li>Select duration "45 minutes"</li>
                    <li>Select environment "Indoor"</li>
                    <li>Check at least 1-2 PE standards</li>
                    <li>Click "Generate Playbook"</li>
                    <li>Verify that a playbook appears</li>
                    <li>Open browser console (F12) to see debug logs</li>
                </ol>
            `;
            results.appendChild(instructions);
        }
        
        // Wait for iframe to load
        window.addEventListener('load', () => {
            setTimeout(runTests, 2000);
        });
    </script>
</body>
</html>